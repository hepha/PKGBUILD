# Maintainer: fauno <fauno@kiwwwi.com.ar>
pkgname=ruby-feedparser
pkgver=0.7
pkgrel=3
pkgdesc="Ruby-Feedparser is an RSS and Atom parser for Ruby. It was initially developed for Feed2Imap, but it is now a standalone library."
arch=('any')
url="http://home.gna.org/ruby-feedparser"
license=('GPL2')
depends=('ruby')
makedepends=('ruby')
md5sums=('a075b191e318f7f57025088ac03baf8b')
source=(http://download.gna.org/${pkgname}/${pkgname}-${pkgver}.tgz)
_rubyname=feedparser

build() {
  cd $srcdir/$pkgname-$pkgver
  sed -i -r "s|rake/rdoctask|rdoc/task|" Rakefile
  sed -i -r "s|rake/gempackagetask|rubygems/packagetask|" Rakefile
  local _rubylibpath="$(ruby -e 'puts $LOAD_PATH' |awk '/^\/usr\/lib\/ruby\/[0-9.]+[^/]$/ {print $1}')"
  ./setup.rb config \
             --prefix=${pkgdir}/usr \
             --sysconfdir=${pkgdir}/etc \
             --rubypath="/usr/bin/env ruby" \
             --libruby=$pkgdir/usr/lib/ruby \
             --librubyver=$pkgdir$_rubylibpath \
             --siteruby=$pkgdir$_rubylibpath \
             --siterubyver=$pkgdir$_rubylibpath 

  ./setup.rb install || return 1
  rake test || return 1

  cd "$pkgdir"$_rubylibpath/$_rubyname
  sed -i '1 i# encoding: ISO-8859-1' feedparser.rb

}
